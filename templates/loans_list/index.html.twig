
{% extends 'base.html.twig' %}

{% block title %}List of all loans{% endblock %}

{% block navigation %}
{{ include('loans_list/_loanNavMenu.html.twig')}}
{% endblock %}

{% block body %}
  <style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
  </style>

  <div>


    <div class="card">
      <div class="card-body">
        <h4 class="card-title">List of all loans</h4>
        <a href="/loans/create"
           role="button" class="btn btn-info btn-sm btn-icon-text mr-3 float-right"  title=" create new loan">
          <i class="mdi mdi-plus-circle-outline btn-icon-prepend"></i>
          Request Loan
        </a>
        <div class="table-responsive pt-3">
          <table class="table table-striped">
            <thead>
            <tr>
              <th>ID</th>
              <th>Amount</th>
              <th>Interest</th>
              <th>Term</th>
              <th>Purpose</th>
              <th>Status</th>
              <th>Borrower</th>
              <th>Bids Progress</th>

              <th></th>
            </tr>
            </thead>
            <tbody>
            {% for item in loanskey %}
              <tr>

                <td> {{ item.id }}    </td>
                <td> {{ item.amount }} TND </td>
                <td> {{ item.interest }} % </td>
                <td> {{ item.term }} mois</td>
                <td> {{ item.purpose }}</td>
                <td> {{ include ('loans_list/_loanStatus.html.twig',{'status':item.status}) }}  </td>
                <td> {{ item.borrower.firstName }} {{ item.borrower.lastName }}</td>
                <td> {{ include ('loans_list/_loanProgress.html.twig',{'progress':item.bidsProgress(),'remainingAmount':item.amount-item.collectedBids(), 'collectedAmount':item.collectedBids() }) }} </td>
                <td>
                  <a href="/loans/{{ item.id }}/bids/create"
                     data-bs-toggle="tooltip" data-bs-placement="bottom" role="button" class="btn btn-success btn-sm btn-icon-text mr-3" title="a bid is a participation in a loan where the owner of the bid lends the borrower a fraction of the loan">
                    <i class="mdi mdi-currency-usd btn-icon-prepend"></i>
                    Bid
                  </a>
                  <a href="/loans/create?id={{ item.id }}"
                     data-bs-toggle="tooltip" data-bs-placement="bottom"
                     role="button" class="btn btn-warning btn-sm btn-icon-text mr-3" title="edit this loan">
                    <i class="mdi mdi-pencil btn-icon-prepend"></i>
                    Edit
                  </a>
                  <button onclick="triggerDeleteLoanModal({{ item.id }})"
                     type="button" class="btn btn-danger btn-sm btn-icon-text mr-3"
                          data-bs-toggle="tooltip" data-bs-placement="bottom" title="delete this loan">
                    <i class="mdi mdi-delete-forever btn-icon-prepend"></i>
                    Delete
                  </button>
                </td>

              </tr>

            {% endfor %}

            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>


<!-- Modal -->
<div id="delete-loan-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Delete Loan</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this loan
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <a role="button" id="delete-loan-link" href="/loans/id/delete" class="btn btn-danger">Yes, delete</a>
      </div>
    </div>
  </div>
</div>

<script>
function triggerDeleteLoanModal(loanId){
  $('#delete-loan-link').attr('href', `/loans/${loanId}/delete`);
  $('#delete-loan-modal').modal();
}
</script>

{% endblock %}
